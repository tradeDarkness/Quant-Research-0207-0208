# 回测大跌原因诊断

## 一、核心数据（测试集 2025-10-01 ~ 2026-02-08）

| 指标 | 数值 |
|------|------|
| 总 K 线数 | 12,506 根 (15m) |
| 预测分数范围 | [0.35, 0.63]，均值≈0.50，**标准差≈0.032** |
| 有信号的 bar 占比 | **86.5%**（几乎一直在多或空） |
| 多空往返次数 | **约 3,922 次**（约每 3.2 根 K 线换一次方向） |
| 仅手续费线性合计 | **392.25%**（相当于本金 3.9 倍被手续费吃掉） |
| 有信号时胜率 (strat_ret>0) | **45.43%**（低于 50%） |
| 方向正确率 | 52.74% |
| 买入持有收益 | -39.10% |
| 策略最终 NAV | **0.023**（约 -97.7%） |

---

## 二、大跌的四个主要原因

### 1. 阈值太窄 → 几乎永远有信号且频繁换向

- 当前：`buy_threshold = mean + 0.1*std`，`sell_threshold = mean - 0.1*std`
- std≈0.032 → 买卖阈值约 **0.498 ~ 0.506**，只差 0.008。
- 分数在 0.35~0.63 之间波动，大部分时间会落在 0.498~0.506 之外 → **86.5% 的 bar 都有多或空信号**。
- 分数在 0.5 附近来回穿越 → **多空频繁切换**（约 3,922 次往返）。

### 2. 交易次数过多 → 手续费复利侵蚀

- 每次多空往返：`pos_change=2`，扣费 `2 × 0.05% = 0.1%`。
- 约 3,922 次往返 → 仅手续费线性加总就约 **392%**。
- 在复利下，每根 K 线都在扣费，净值被持续侵蚀，**手续费是拖垮净值的主因之一**。

### 3. 胜率不足 → 无法覆盖成本与错误方向

- 有信号时胜率 **45.43%** < 50%，说明“有信号”时多数是亏的。
- 方向正确率 52.74% 略高于随机，但优势很小；配合极高频交易和 0.1% 往返成本，**小优势被成本和错误方向完全抵消并反噬**。

### 4. 测试期市场下跌 → 做多天然不利

- 买入持有收益 **-39.10%**，测试段 BTC 整体下跌。
- 做多时平均 return 略负，做空时略赚，但策略因频繁换向和巨额手续费，表现远差于简单持有（-97.7% vs -39.1%）。

---

## 三、建议改动（优先级从高到低）

1. **放宽阈值，大幅减少交易频率**
   - 例如：`mean ± 0.5*std` 或 `mean ± 1.0*std`，或固定 0.45/0.55。
   - 目标：只有“信心足够高”时才交易，把有信号 bar 占比压到 20%~40%，往返次数降到几百次量级。

2. **中性区不交易**
   - 保持 `score in (sell_threshold, buy_threshold)` 时 `signal=0`，不扣手续费、不参与多空，避免在 0.5 附近来回蹭。

3. **提高预测质量**
   - 当前 AUC~0.53，预测能力有限；可考虑更多/更好的因子、调参、或更长周期（如 1h）降低噪音。

4. **手续费与成本假设**
   - 若实盘手续费/滑点更高，需在回测里提高 `cost` 再测，避免过度交易。

5. **与买入持有对比**
   - 回测中同时输出“买入持有”曲线，确保策略在相同区间内至少不能长期大幅跑输持有。

---

## 四、小结

| 原因 | 影响 |
|------|------|
| 阈值太窄 (0.1*std) | 86.5% 有信号、约 3922 次往返 |
| 手续费 0.05%×2/往返 | 线性合计约 392%，复利下净值被快速打穿 |
| 胜率 45.43% | 无法覆盖成本与错误方向 |
| 测试期下跌 | 做多不利，但策略跌幅远大于持有 |

**结论**：回测大跌主要来自 **过度交易 + 手续费复利侵蚀**，其次才是预测不准和测试期市场下跌。优先通过 **放宽阈值、减少交易频率** 再回测，并监控交易次数与手续费占比。
