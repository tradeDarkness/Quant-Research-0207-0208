<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gen-10 EPIC å›æµ‹äº¤æ˜“å†å² | 15171x</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --border-color: #30363d;
            --profit-color: #3fb950;
            --loss-color: #f85149;
            --accent-color: #58a6ff;
            --gold-color: #f0b90b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header h1 .badge {
            background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        /* æ ¸å¿ƒç»Ÿè®¡å¡ç‰‡ */
        .core-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .core-stat {
            background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .core-stat.highlight {
            background: linear-gradient(135deg, rgba(240, 185, 11, 0.15) 0%, rgba(240, 185, 11, 0.05) 100%);
            border-color: var(--gold-color);
        }

        .core-stat .label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .core-stat .value {
            font-size: 28px;
            font-weight: 700;
        }

        .core-stat .sub {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .core-stat .value.profit {
            color: var(--profit-color);
        }

        .core-stat .value.loss {
            color: var(--loss-color);
        }

        .core-stat .value.gold {
            color: var(--gold-color);
        }

        /* è¯¦ç»†ç»Ÿè®¡ç½‘æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .stat-item {
            background: var(--bg-tertiary);
            padding: 14px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-item .label {
            color: var(--text-secondary);
            font-size: 11px;
            margin-bottom: 4px;
        }

        .stat-item .value {
            font-size: 16px;
            font-weight: 600;
        }

        .stat-item .value.profit {
            color: var(--profit-color);
        }

        .stat-item .value.loss {
            color: var(--loss-color);
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .controls input,
        .controls select {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .controls input:focus,
        .controls select:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .table-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        th {
            background: var(--bg-tertiary);
            padding: 12px 10px;
            text-align: left;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
            font-family: 'SF Mono', Consolas, monospace;
        }

        tr:hover td {
            background: var(--bg-tertiary);
        }

        .direction {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
            font-size: 11px;
        }

        .direction.long {
            background: rgba(63, 185, 80, 0.15);
            color: var(--profit-color);
        }

        .direction.short {
            background: rgba(248, 81, 73, 0.15);
            color: var(--loss-color);
        }

        .pnl.positive {
            color: var(--profit-color);
        }

        .pnl.negative {
            color: var(--loss-color);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 16px;
            border-top: 1px solid var(--border-color);
        }

        .pagination button {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination button:hover:not(:disabled) {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .page-info {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        @media (max-width: 1200px) {
            .core-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .core-stats {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>
                ğŸ“Š Gen-10 EPIC å›æµ‹äº¤æ˜“å†å²
                <span class="badge">+15171x</span>
            </h1>

            <!-- æ ¸å¿ƒç»Ÿè®¡ -->
            <div class="core-stats">
                <div class="core-stat highlight">
                    <div class="label">ğŸ’° æ€»ç›ˆåˆ©ï¼ˆETH ç‚¹æ•°ï¼‰</div>
                    <div class="value gold" id="totalPoints">-</div>
                    <div class="sub" id="totalPointsSub">å‡è®¾æ¯ç¬” 1 ETH</div>
                </div>
                <div class="core-stat">
                    <div class="label">ğŸ“ˆ ç´¯è®¡æ”¶ç›Šç‡</div>
                    <div class="value profit" id="totalReturn">-</div>
                    <div class="sub">å¤åˆ©è®¡ç®—</div>
                </div>
                <div class="core-stat">
                    <div class="label">ğŸ¯ èƒœç‡</div>
                    <div class="value" id="winRate">-</div>
                    <div class="sub" id="winRateSub">-</div>
                </div>
                <div class="core-stat">
                    <div class="label">âš¡ ç›ˆäºæ¯”</div>
                    <div class="value" id="profitFactor">-</div>
                    <div class="sub" id="profitFactorSub">å¹³å‡ç›ˆåˆ©/å¹³å‡äºæŸ</div>
                </div>
            </div>

            <!-- è¯¦ç»†ç»Ÿè®¡ -->
            <div class="stats-grid" id="stats">
                <div class="stat-item">
                    <div class="label">æ€»äº¤æ˜“ç¬”æ•°</div>
                    <div class="value" id="totalTrades">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">ç›ˆåˆ©ç¬”æ•°</div>
                    <div class="value profit" id="winTrades">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">äºæŸç¬”æ•°</div>
                    <div class="value loss" id="lossTrades">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">æœ€å¤§å•ç¬”ç›ˆåˆ©</div>
                    <div class="value profit" id="maxWin">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">æœ€å¤§å•ç¬”äºæŸ</div>
                    <div class="value loss" id="maxLoss">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">å¹³å‡ç›ˆåˆ©</div>
                    <div class="value profit" id="avgWin">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">å¹³å‡äºæŸ</div>
                    <div class="value loss" id="avgLoss">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">åšå¤šæ¬¡æ•°</div>
                    <div class="value" id="longCount">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">åšç©ºæ¬¡æ•°</div>
                    <div class="value" id="shortCount">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">åšå¤šèƒœç‡</div>
                    <div class="value" id="longWinRate">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">åšç©ºèƒœç‡</div>
                    <div class="value" id="shortWinRate">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">æœ€å¤§è¿ç»­ç›ˆåˆ©</div>
                    <div class="value profit" id="maxWinStreak">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">æœ€å¤§è¿ç»­äºæŸ</div>
                    <div class="value loss" id="maxLossStreak">-</div>
                </div>
                <div class="stat-item">
                    <div class="label">æ—¥å‡äº¤æ˜“</div>
                    <div class="value" id="avgDailyTrades">-</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <label style="color: var(--text-secondary); font-size: 13px;">æ—¶é—´æ®µï¼š</label>
            <input type="date" id="startDate" style="width: 140px;">
            <span style="color: var(--text-secondary);">è‡³</span>
            <input type="date" id="endDate" style="width: 140px;">
            <button onclick="clearDateFilter()"
                style="background: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 8px 12px; border-radius: 6px; cursor: pointer;">æ¸…é™¤</button>
            <select id="directionFilter">
                <option value="">å…¨éƒ¨æ–¹å‘</option>
                <option value="long">åšå¤š</option>
                <option value="short">åšç©º</option>
            </select>
            <select id="resultFilter">
                <option value="">å…¨éƒ¨ç»“æœ</option>
                <option value="profit">ç›ˆåˆ©</option>
                <option value="loss">äºæŸ</option>
            </select>
            <select id="pageSize">
                <option value="50">æ¯é¡µ 50 æ¡</option>
                <option value="100" selected>æ¯é¡µ 100 æ¡</option>
                <option value="200">æ¯é¡µ 200 æ¡</option>
                <option value="500">æ¯é¡µ 500 æ¡</option>
            </select>
        </div>

        <div class="table-container">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>å¼€ä»“æ—¶é—´</th>
                            <th>å¹³ä»“æ—¶é—´</th>
                            <th>æ–¹å‘</th>
                            <th>å¼€ä»“ä»·</th>
                            <th>å¹³ä»“ä»·</th>
                            <th>ç›ˆäºç‚¹æ•°</th>
                            <th>æ”¶ç›Šç‡</th>
                            <th>æ¨¡å‹å¾—åˆ†</th>
                            <th>ç´¯è®¡æ”¶ç›Š</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="10" class="loading">åŠ è½½ä¸­...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="pagination">
                <button id="prevBtn" onclick="prevPage()">ä¸Šä¸€é¡µ</button>
                <span class="page-info" id="pageInfo">ç¬¬ 1 é¡µ</span>
                <button id="nextBtn" onclick="nextPage()">ä¸‹ä¸€é¡µ</button>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let priceData = {};
        let filteredData = [];
        let currentPage = 1;
        let pageSize = 100;

        // åŠ è½½ä»·æ ¼æ•°æ®
        async function loadPriceData() {
            try {
                const response = await fetch('ETHUSDT_Swap_10m_1y.csv');
                const text = await response.text();
                const lines = text.trim().split('\n');

                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',');
                    const datetime = values[0];
                    priceData[datetime] = {
                        open: parseFloat(values[1]),
                        high: parseFloat(values[2]),
                        low: parseFloat(values[3]),
                        close: parseFloat(values[4])
                    };
                }
                console.log('Loaded price data:', Object.keys(priceData).length, 'bars');
            } catch (error) {
                console.error('Failed to load price data:', error);
            }
        }

        // åŠ è½½å›æµ‹æ•°æ®
        async function loadData() {
            await loadPriceData();

            try {
                const response = await fetch('ai_backtest_results.csv');
                const text = await response.text();
                const lines = text.trim().split('\n');

                allData = lines.slice(1).map((line, index) => {
                    const values = line.split(',');
                    const datetime = values[0];
                    const strategyReturn = parseFloat(values[5]);
                    const signal = parseInt(values[4]);

                    // è·å–å¼€ä»“å’Œå¹³ä»“ä»·æ ¼
                    const openTime = new Date(datetime);
                    const closeTime = new Date(openTime.getTime() + 10 * 60 * 1000);
                    const closeTimeStr = closeTime.toISOString().replace('T', ' ').substring(0, 19);

                    // ä»ä»·æ ¼æ•°æ®è·å–å®é™…ä»·æ ¼
                    const openPrice = priceData[datetime]?.close || 2500;

                    // label æ˜¯åŸå§‹ä»·æ ¼å˜åŒ–ï¼ˆclose/open - 1ï¼‰ï¼Œä¸å«æ–¹å‘
                    const label = parseFloat(values[2]);

                    // å¹³ä»“ä»· = å¼€ä»“ä»· * (1 + åŸå§‹ä»·æ ¼å˜åŒ–)
                    // è¿™æ ·åšç©ºæ—¶ï¼šä»·æ ¼ä¸Šæ¶¨ â†’ å¹³ä»“ä»· > å¼€ä»“ä»· â†’ äºæŸ
                    const closePrice = openPrice * (1 + label);

                    // ç›ˆäºç‚¹æ•°åŸºäºç­–ç•¥æ”¶ç›Šç‡è®¡ç®—ï¼ˆå·²åŒ…å«æ–¹å‘ï¼‰
                    const pnlPoints = openPrice * strategyReturn;

                    return {
                        id: index + 1,
                        datetime: datetime,
                        closeTime: closeTimeStr,
                        instrument: values[1],
                        label: parseFloat(values[2]),
                        pred: parseFloat(values[3]),
                        signal: signal,
                        strategyReturn: strategyReturn,
                        netReturn: parseFloat(values[6]),
                        cumRet: parseFloat(values[7]),
                        openPrice: openPrice,
                        closePrice: closePrice,
                        pnlPoints: pnlPoints
                    };
                });

                // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
                allData.reverse();

                filteredData = [...allData];
                updateStats();
                renderTable();
            } catch (error) {
                document.getElementById('tableBody').innerHTML =
                    '<tr><td colspan="10" class="loading">åŠ è½½å¤±è´¥: ' + error.message + '</td></tr>';
            }
        }

        function updateStats() {
            const wins = filteredData.filter(d => d.strategyReturn > 0);
            const losses = filteredData.filter(d => d.strategyReturn < 0);
            const longs = filteredData.filter(d => d.signal === 1);
            const shorts = filteredData.filter(d => d.signal === -1);
            const longWins = longs.filter(d => d.strategyReturn > 0);
            const shortWins = shorts.filter(d => d.strategyReturn > 0);

            // è®¡ç®—æ€»ç›ˆåˆ©ç‚¹æ•°
            const totalPoints = filteredData.reduce((sum, d) => sum + d.pnlPoints, 0);

            // è®¡ç®—å¹³å‡ç›ˆäº
            const avgWin = wins.length > 0 ? wins.reduce((s, d) => s + d.strategyReturn, 0) / wins.length : 0;
            const avgLoss = losses.length > 0 ? Math.abs(losses.reduce((s, d) => s + d.strategyReturn, 0) / losses.length) : 1;

            // è®¡ç®—è¿ç»­ç›ˆäº
            let maxWinStreak = 0, maxLossStreak = 0;
            let currentWin = 0, currentLoss = 0;
            filteredData.forEach(d => {
                if (d.strategyReturn > 0) {
                    currentWin++;
                    currentLoss = 0;
                    maxWinStreak = Math.max(maxWinStreak, currentWin);
                } else {
                    currentLoss++;
                    currentWin = 0;
                    maxLossStreak = Math.max(maxLossStreak, currentLoss);
                }
            });

            // è®¡ç®—æ—¥å‡äº¤æ˜“
            const firstDate = new Date(filteredData[0]?.datetime);
            const lastDate = new Date(filteredData[filteredData.length - 1]?.datetime);
            const days = Math.max(1, (lastDate - firstDate) / (1000 * 60 * 60 * 24));
            const avgDailyTrades = (filteredData.length / days).toFixed(1);

            // ç´¯è®¡æ”¶ç›Š
            const finalCumRet = filteredData[filteredData.length - 1]?.cumRet || 1;

            // æ›´æ–°æ ¸å¿ƒç»Ÿè®¡
            document.getElementById('totalPoints').textContent = totalPoints.toFixed(2) + ' ç‚¹';
            document.getElementById('totalPointsSub').textContent = `â‰ˆ $${totalPoints.toFixed(2)} (1ETH)`;
            document.getElementById('totalReturn').textContent = finalCumRet.toFixed(0) + 'x';
            document.getElementById('winRate').textContent = ((wins.length / filteredData.length) * 100).toFixed(1) + '%';
            document.getElementById('winRateSub').textContent = `${wins.length} ç›ˆ / ${losses.length} äº`;
            document.getElementById('profitFactor').textContent = (avgWin / avgLoss).toFixed(2);
            document.getElementById('profitFactorSub').textContent = `${(avgWin * 100).toFixed(3)}% / ${(avgLoss * 100).toFixed(3)}%`;

            // æ›´æ–°è¯¦ç»†ç»Ÿè®¡
            document.getElementById('totalTrades').textContent = filteredData.length.toLocaleString();
            document.getElementById('winTrades').textContent = wins.length.toLocaleString();
            document.getElementById('lossTrades').textContent = losses.length.toLocaleString();

            const maxWin = Math.max(...filteredData.map(d => d.strategyReturn));
            const maxLoss = Math.min(...filteredData.map(d => d.strategyReturn));

            document.getElementById('maxWin').textContent = '+' + (maxWin * 100).toFixed(3) + '%';
            document.getElementById('maxLoss').textContent = (maxLoss * 100).toFixed(3) + '%';
            document.getElementById('avgWin').textContent = '+' + (avgWin * 100).toFixed(3) + '%';
            document.getElementById('avgLoss').textContent = '-' + (avgLoss * 100).toFixed(3) + '%';

            document.getElementById('longCount').textContent = longs.length.toLocaleString();
            document.getElementById('shortCount').textContent = shorts.length.toLocaleString();
            document.getElementById('longWinRate').textContent = longs.length > 0 ? ((longWins.length / longs.length) * 100).toFixed(1) + '%' : '-';
            document.getElementById('shortWinRate').textContent = shorts.length > 0 ? ((shortWins.length / shorts.length) * 100).toFixed(1) + '%' : '-';

            document.getElementById('maxWinStreak').textContent = maxWinStreak + ' æ¬¡';
            document.getElementById('maxLossStreak').textContent = maxLossStreak + ' æ¬¡';
            document.getElementById('avgDailyTrades').textContent = avgDailyTrades + ' ç¬”';
        }

        function renderTable() {
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = filteredData.slice(start, end);

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = pageData.map(row => {
                const direction = row.signal === 1 ? 'long' : 'short';
                const directionText = row.signal === 1 ? 'ğŸŸ¢ åšå¤š' : 'ğŸ”´ åšç©º';
                const pnlClass = row.strategyReturn > 0 ? 'positive' : 'negative';
                const pnlSign = row.strategyReturn > 0 ? '+' : '';
                const pointsSign = row.pnlPoints > 0 ? '+' : '';

                return `
                    <tr>
                        <td>${row.id}</td>
                        <td>${row.datetime}</td>
                        <td>${row.closeTime}</td>
                        <td><span class="direction ${direction}">${directionText}</span></td>
                        <td>$${row.openPrice.toFixed(2)}</td>
                        <td>$${row.closePrice.toFixed(2)}</td>
                        <td class="pnl ${pnlClass}">${pointsSign}${row.pnlPoints.toFixed(2)}</td>
                        <td class="pnl ${pnlClass}">${pnlSign}${(row.strategyReturn * 100).toFixed(4)}%</td>
                        <td>${row.pred.toFixed(6)}</td>
                        <td>${row.cumRet.toFixed(2)}x</td>
                    </tr>
                `;
            }).join('');

            const totalPages = Math.ceil(filteredData.length / pageSize);
            document.getElementById('pageInfo').textContent =
                `ç¬¬ ${currentPage} / ${totalPages} é¡µ (å…± ${filteredData.length} æ¡)`;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages;
        }

        function prevPage() {
            if (currentPage > 1) { currentPage--; renderTable(); }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            if (currentPage < totalPages) { currentPage++; renderTable(); }
        }

        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const direction = document.getElementById('directionFilter').value;
            const result = document.getElementById('resultFilter').value;

            filteredData = allData.filter(row => {
                // æ—¥æœŸèŒƒå›´ç­›é€‰
                if (startDate) {
                    const rowDate = row.datetime.split(' ')[0];
                    if (rowDate < startDate) return false;
                }
                if (endDate) {
                    const rowDate = row.datetime.split(' ')[0];
                    if (rowDate > endDate) return false;
                }
                // æ–¹å‘ç­›é€‰
                if (direction === 'long' && row.signal !== 1) return false;
                if (direction === 'short' && row.signal !== -1) return false;
                // ç»“æœç­›é€‰
                if (result === 'profit' && row.strategyReturn <= 0) return false;
                if (result === 'loss' && row.strategyReturn >= 0) return false;
                return true;
            });

            currentPage = 1;
            updateStats();
            renderTable();
        }

        function clearDateFilter() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            applyFilters();
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('startDate').addEventListener('change', applyFilters);
        document.getElementById('endDate').addEventListener('change', applyFilters);
        document.getElementById('directionFilter').addEventListener('change', applyFilters);
        document.getElementById('resultFilter').addEventListener('change', applyFilters);
        document.getElementById('pageSize').addEventListener('change', (e) => {
            pageSize = parseInt(e.target.value);
            currentPage = 1;
            renderTable();
        });

        // åˆå§‹åŒ–
        loadData();
    </script>
</body>

</html>